<form action="/formulario/inserir" method="POST" id="formParte1">
    <input type="hidden" name="parte" value="1">
    <input type="hidden" name="idFormulario" value="{{idFormulario}}">

    <div class="card">
        <div class="card-body">
            <h5 class="section-title">1. Dados da Unidade e Localização</h5>

            <div class="mb-3">
                <label class="form-label fw-bold">Qual unidade você vai avaliar?</label>
                <select class="form-select" name="unidade" required>
                    <option value="" selected disabled>Selecione...</option>
                    <option value="Hospital">Hospital (HDS)</option>
                    <option value="PAM">Pronto Atendimento Municipal (PAM)</option>
                </select>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Em qual cidade você mora?</label>
                    <select class="form-select" name="cidade" id="cidade" required>
                        <option value="" selected disabled>Selecione...</option>
                        <option value="Divino">Divino</option>
                        <option value="São João do Manhuaçu">São João do Manhuaçu</option>
                        <option value="Luisburgo">Luisburgo</option>
                        <option value="Orizânia">Orizânia</option>
                        <option value="Santa Margarida">Santa Margarida</option>
                        <option value="Pedra Bonita">Pedra Bonita</option>
                        <option value="Fervedouro">Fervedouro</option>
                        <option value="Carangola">Carangola</option>
                        <option value="Espera Feliz">Espera Feliz</option>
                        <option value="Caparaó">Caparaó</option>
                        <option value="Outra">Outra Cidade / Limítrofe</option>
                    </select>
                </div>
            </div>

            <div id="divino-options" style="display: none;">
                <div class="mb-3">
                    <label class="form-label">Zona Rural ou Urbana?</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="zona" id="urbana" value="Urbana">
                        <label class="btn btn-outline-secondary" for="urbana">Cidade (Urbana)</label>

                        <input type="radio" class="btn-check" name="zona" id="rural" value="Rural">
                        <label class="btn btn-outline-secondary" for="rural">Zona Rural</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Se mora na cidade, qual o bairro?</label>
                        <select class="form-select" name="bairro" id="bairro" disabled required>
                            <option value="" selected disabled>Selecione...</option>
                            <option value="Centro">Centro</option>
                            <option value="Viletes">Viletes</option>
                            <option value="Givisiez">Givisiez</option>
                            <option value="Soraya">Soraya</option>
                            <option value="Cidade Nova">Cidade Nova</option>
                            <option value="Alvorada">Alvorada</option>
                            <option value="João Dornelas">João Dornelas</option>
                            <option value="Lourdes">Lourdes</option>
                            <option value="Nossa Senhora das Dores">Nossa Senhora das Dores</option>
                            <option value="Parque / Parque Industrial">Parque / Parque Industrial</option>
                            <option value="Monte Alto">Monte Alto</option>
                            <option value="Eldorado">Eldorado</option>
                            <option value="Vale Verde">Vale Verde</option>
                        </select>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label class="form-label">Se mora na Zona Rural, qual comunidade?</label>
                        <select class="form-select" name="comunidade" id="comunidade" disabled required>
                            <option value="" selected disabled>Selecione...</option>
                            <option value="Bom Jesus do Divino">Bom Jesus do Divino</option>
                            <option value="São João do Norte">São João do Norte</option>
                            <option value="Vargem Grande (ou Vargem Grande do Divino)">Vargem Grande (ou Vargem Grande do Divino)</option>
                            <option value="Barra do Taquaraçu (Taquaraçu)">Barra do Taquaraçu (Taquaraçu)</option>
                            <option value="Vila Mônica">Vila Mônica</option>
                            <option value="Neblina / São Tiago da Neblina">Neblina / São Tiago da Neblina</option>
                            <option value="Arataca">Arataca</option>
                            <option value="Gruta Liberdade">Gruta Liberdade</option>
                            <option value="Vila Tropical">Vila Tropical</option>
                        </select>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="d-grid gap-2 mb-5 mt-3" style="grid-template-columns: 1fr 2fr;">
        <button type="button" class="btn btn-primary btn-lg" onclick="history.back()">
            Voltar
        </button>
        <button type="submit" class="btn btn-success btn-lg" id="btn-proxima" disabled>
            Próxima
        </button>
    </div>
</form>

<script>
    const form = document.getElementById('formParte1');
    const btnProxima = document.getElementById('btn-proxima');
    const cidadeSelect = document.getElementById('cidade');
    const divinoOptions = document.getElementById('divino-options');
    const radioUrbana = document.getElementById('urbana');
    const radioRural = document.getElementById('rural');
    const bairro = document.getElementById('bairro');
    const comunidade = document.getElementById('comunidade');

    function validarFormulario() {
        const inputsObrigatorios = form.querySelectorAll('[required]');
        let tudoPreenchido = true;

        inputsObrigatorios.forEach(input => {
            if (input.type === 'radio') {
                const name = input.name;
                const radioGroup = form.querySelectorAll(`input[name="${name}"]`);
                const algumSelecionado = Array.from(radioGroup).some(r => r.checked);
                if (!algumSelecionado) tudoPreenchido = false;
            } else {
                if (!input.value || input.value === "") {
                    tudoPreenchido = false;
                }
            }
        });

        btnProxima.disabled = !tudoPreenchido;
    }

    function atualizarCampos() {
        if (radioUrbana.checked) {
            bairro.disabled = false;
            bairro.required = true;
            comunidade.disabled = true;
            comunidade.required = false;
            comunidade.value = ""; 
        } else if (radioRural.checked) {
            comunidade.disabled = false;
            comunidade.required = true;
            bairro.disabled = true;
            bairro.required = false;
            bairro.value = ""; 
        }
        validarFormulario();
    }

    function gerenciarDivino() {
        if (cidadeSelect.value === "Divino") {
            divinoOptions.style.display = "block";
            radioUrbana.disabled = false;
            radioRural.disabled = false;
            radioUrbana.required = true;
            radioRural.required = true;
            atualizarCampos();
        } else {
            divinoOptions.style.display = "none";
            radioUrbana.disabled = true;
            radioRural.disabled = true;
            radioUrbana.required = false;
            radioRural.required = false;
            radioUrbana.checked = false;
            radioRural.checked = false;
            bairro.disabled = true;
            bairro.required = false;
            bairro.value = "";
            comunidade.disabled = true;
            comunidade.required = false;
            comunidade.value = "";
            validarFormulario();
        }
    }

    form.addEventListener('change', validarFormulario);
    form.addEventListener('input', validarFormulario);

    radioUrbana.addEventListener('change', atualizarCampos);
    radioRural.addEventListener('change', atualizarCampos);
    cidadeSelect.addEventListener('change', gerenciarDivino);

    window.addEventListener('pageshow', function(event) {
        gerenciarDivino();
        validarFormulario();
    });

    gerenciarDivino();
    validarFormulario();
</script>