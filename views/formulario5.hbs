<form action="/formulario/inserir" method="POST" id="formParte5">
    <input type="hidden" name="parte" value="5">
    <input type="hidden" name="idFormulario" value="{{idFormulario}}">

    <div class="card">
        <div class="card-body">
            <h5 class="section-title">5. Direitos do Usuário</h5>

            <div class="mb-3">
                <label class="form-label fw-bold">
                    Você sabe onde reclamar caso seja mal atendido?
                </label>
                <div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sabe_reclamar"
                            id="reclamar_sim" value="Sim" required>
                        <label class="form-check-label" for="reclamar_sim">Sim</label>
                    </div>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="sabe_reclamar"
                            id="reclamar_nao" value="Nao" required>
                        <label class="form-check-label" for="reclamar_nao">Não</label>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">
                    Você pagou algum valor durante o atendimento?
                </label>
                <div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="pagou_valor"
                            id="pagou_sim" value="Sim" required>
                        <label class="form-check-label" for="pagou_sim">Sim</label>
                    </div>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="pagou_valor"
                            id="pagou_nao" value="Nao" required>
                        <label class="form-check-label" for="pagou_nao">Não</label>
                    </div>
                </div>
            </div>

            <div class="mb-3" id="pagamento_container">
                <label class="form-label">
                    Se sim, o quê?
                </label>
                <input type="number" min="0" step="0.01" class="form-control"
                    name="descricao_pagamento"
                    placeholder="Escreva o valor"
                    id="descricao_pagamento">
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">
                    Você sabe o nome do profissional que o atendeu?
                </label>
                <div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="nome_profissional"
                            id="prof_sim" value="Sim" required>
                        <label class="form-check-label" for="prof_sim">Sim</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="nome_profissional"
                            id="prof_nao" value="Nao" required>
                        <label class="form-check-label" for="prof_nao">Não</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="nome_profissional"
                            id="prof_nao_lembro" value="Nao lembro" required>
                        <label class="form-check-label" for="prof_nao_lembro">Não lembro</label>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="d-grid gap-2 mb-5 mt-3" style="grid-template-columns: 1fr 2fr;">
        <button type="button" class="btn btn-primary btn-lg" onclick="history.back()">
            Voltar
        </button>
        <button type="submit" class="btn btn-success btn-lg" id="btn-proxima" disabled>
            Próxima
        </button>
    </div>
</form>

<script>
    const form = document.getElementById('formParte5');
    const btnProxima = document.getElementById('btn-proxima');
    const pagouSim = document.getElementById('pagou_sim');
    const pagouNao = document.getElementById('pagou_nao');
    const pagamentoContainer = document.getElementById('pagamento_container');
    const descricaoPagamento = document.getElementById('descricao_pagamento');

    function validarFormulario() {
        const obrigatorios = form.querySelectorAll('[required]');
        let tudoOk = true;

        obrigatorios.forEach(campo => {
            if (campo.type === 'radio') {
                const grupo = form.querySelectorAll(`input[name="${campo.name}"]`);
                if (!Array.from(grupo).some(r => r.checked)) tudoOk = false;
            } else {
                if (!campo.value.trim()) tudoOk = false;
            }
        });

        btnProxima.disabled = !tudoOk;
    }

    function atualizarPagamento() {
        if (pagouSim.checked) {
            pagamentoContainer.style.display = 'block';
            descricaoPagamento.setAttribute('required', 'required');
            descricaoPagamento.disabled = false;
        } else {
            pagamentoContainer.style.display = 'none';
            descricaoPagamento.value = '';
            descricaoPagamento.removeAttribute('required');
            descricaoPagamento.disabled = true;
        }
        validarFormulario();
    }

    form.addEventListener('change', validarFormulario);
    form.addEventListener('input', validarFormulario);
    pagouSim.addEventListener('change', atualizarPagamento);
    pagouNao.addEventListener('change', atualizarPagamento);

    window.addEventListener('pageshow', () => {
        atualizarPagamento();
    });

    atualizarPagamento();
</script>